# Node.js with Angular
# Build a Node.js project that uses Angular.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- main

pool:
  vmImage: 'ubuntu-latest'
  
steps:
  - task: Npm@0
    displayName: 'npm install'
    inputs:
      arguments: '--force'

  - task: Npm@1
    displayName: 'npm install angular cli'
    inputs:
      command: custom
      verbose: false
      customCommand: 'install @angular/cli'
  - task: Npm@1
    displayName: 'npm build'
    inputs:
      command: custom
      verbose: false
      customCommand: 'run build --prod'
  # - task: ArchiveFiles@1
  #   displayName: 'Archive files '
  #   inputs:
  #     rootFolder: '$(System.DefaultWorkingDirectory)/dist' #name of your project on angular.json .defaultProject value
  #     includeRootFolder: false
  # - task: CopyFiles@2
  #   displayName: 'Copy File to: $(TargetFolder)'
  #   inputs:
  #     SourceFolder: '$(Build.ArtifactStagingDirectory)'
  #     Contents: '$(Build.BuildId).zip'
  #     TargetFolder: '$(Build.ArtifactStagingDirectory)\dist'
  - task: AzureRmWebAppDeployment@4
    inputs:
      ConnectionType: 'AzureRM'
      azureSubscription: 'Azure subscription 1(6c74c0b1-61b3-44e6-bada-c36d5a1eb330)'
      appType: 'webApp'
      WebAppName: 'TestAngularApp1'
      packageForLinux: '$(System.DefaultWorkingDirectory)/dist/*.*'
